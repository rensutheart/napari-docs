(contributing-docs)=
# Contributing Documentation

This guide will teach you how to contribute to napari's documentation.

To begin contributing, you will need:

- Some familiarity with [`git`](https://git-scm.com).
- A [GitHub](https://github.com) account.

Choose an approach to contributing:

1. [**Contributing without a local setup**](#contributing-to-the-napari-documentation-without-a-local-setup): This is a simpler approach that allows you
   to make small changes to the documentation without needing to set up a local
   environment. This approach is useful for quick edits or if you are not familiar
   with Git or the command line.
1. [**Contributing with a local setup**](#contributing-to-the-napari-documentation-with-a-local-setup): This is the recommended approach if you are
   making significant changes to the documentation, or if you want to preview your
   changes _before_ submitting them. This approach requires a local setup of the
   napari and docs repositories.

## Ask for guidance

If you'd like to contribute a brand new document to our usage section, it's
worth [opening an issue](https://github.com/napari/docs/issues/new/choose)
on our repository to discuss the content you'd like to see and get some
early feedback from the community. The napari team can also suggest what type of
document would be best suited, and whether there are already existing documents
that could be expanded to include your proposed content.

### Organization of the documentation

The napari documentation is built from multiple sources that are organized into repositories:
1. The main napari documentation is built from sources located at the
[napari/docs](https://github.com/napari/docs) repository on GitHub.
That repository is where all the narrative documentation (e.g. tutorials, how-to
guides, etc. on napari.org) pull requests should be made.
This narrative napari documentation is written in
[MyST markdown](https://myst-parser.readthedocs.io/en/latest/index.html),
a version of [commonmark](https://spec.commonmark.org/) Markdown
(see a [markdown cheatsheet](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet))
with some additional features.
2. Some of the documentation about [plugins](plugins-index) resides in
the [napari/npe2](https://github.com/napari/npe2) repository
(e.g. the [contributions reference page](contributions-ref)) and should be modified there.
This is documentation is written with [Jinja](https://jinja.palletsprojects.com/en/3.1.x/).
3. The [examples gallery](gallery) is generated from Python source files and changes to the gallery should be made to the
[napari/napari](https://github.com/napari/napari) repository (see also
[the guide on adding examples to the gallery](add-examples)).
4. Changes to how [napari.org](https://napari.org/dev) appears site-wide are made to the
[napari-sphinx-theme](https://github.com/napari/napari-sphinx-theme).
5. The [API reference documentation](api) is autogenerated from the napari source code docstrings.
Docstrings are written in the [reStructuredText format](https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html)
and any modifications to them should be submitted to the [napari/napari](https://github.com/napari/napari) repository.
6. Importantly, all of the dependencies for building the documentation are in the [the `pyproject.toml` of napari/napari](https://github.com/napari/napari/blob/main/pyproject.toml) under the optional dependencies `docs` and `gallery`.

### What types of documents can I contribute?

Go to the [`napari/docs`](https://github.com/napari/docs) repo to find examples of documents you might
want to contribute. The paths are listed in parentheses below.

- [**Explanations**](explanations) (in [`napari/docs/guides`](https://github.com/napari/docs/tree/main/docs/guides)):
  in depth content about napari architecture, development choices and some complex features
- [**Tutorials**](tutorials) (in [`napari/docs/tutorials`](https://github.com/napari/docs/tree/main/docs/tutorials)):
  detailed, reproducible step by step guides, usually combining multiple napari features to complete a potentially complex task
- [**How-tos**](how-tos) (in [`napari/docs/howtos`](https://github.com/napari/docs/tree/main/docs/howtos)):
  simple step by step guides demonstrating the use of common features
- [**Getting started**](getting-started) (in [`napari/docs/tutorials/fundamentals`](https://github.com/napari/docs/tree/main/docs/tutorials/fundamentals)):
  these documents are a mix of tutorials and how-tos covering the fundamentals of installing and working with napari for beginners

The [**Examples gallery**](gallery) sources are in the [main `napari/napari` repository](https://github.com/napari/napari/tree/main/examples)
and show code examples of how to use napari.

```{admonition} Plugin documentation
:class: tip

Some of the source files for the [Plugin documentation](plugins-index) are
autogenerated from sources in the [napari/npe2](https://github.com/napari/npe2)
repository. Any edits should be made in the `napari/npe2` repo, and not to the
copy you may have in the `napari/docs` folder. These files' names start with the
`_npe2_` prefix and are located under the `docs/plugins` folder. They will be
generated when the documentation is built and the
[`prep_docs.py`](https://github.com/napari/docs/blob/main/docs/_scripts/prep_docs.py)
script is run. See our
[Makefile](https://github.com/napari/docs/blob/main/Makefile) for more details.
```

```{admonition} Got materials for a workshop?
:class: tip

If you already have teaching materials e.g. recordings, slide decks or Jupyter notebooks
hosted somewhere, you can add links to these on our [napari workshops](workshops) page.
```

### Formats and templates

Our goal is that all tutorials and how-tos are easily downloadable and
executable by our users. This helps ensure that they are reproducible and makes
them easier to maintain. [Jupyter notebooks](https://jupyter.org/) are a great
option for our documents, because they allow you to easily combine code and well
formatted text in markdown and can be executed automatically. However, their
[raw JSON format](https://numpy.org/numpy-tutorials/content/pairing.html#background)
is not great for version control, so we use [MyST Markdown](https://myst-parser.readthedocs.io/en/latest/)
documents in our repository and on [napari.org](https://napari.org).

If you are amending existing documentation, you can do so in your preferred text
editor. If you wish to add a new tutorial or a how-to, we recommend you use our
[template](docs-template). Inside the template you'll find handy tips for
taking screenshots of the viewer, hiding code cells, using style guides and what
to include in the required prerequisites section.

To use the template, make a copy of `docs/developers/documentation/docs_template.md`
and rename it to match your content. You can edit the template directly in
Jupyter notebook, or in your preferred text editor.

```{admonition} Already have a notebook?
:class: tip

If you have an existing `.ipynb` Jupyter notebook that you'd like to contribute, you can convert it to MyST markdown and then edit the `.md` file to prepare it for contributing. For the conversion, you can install the [`jupytext` package](https://jupytext.readthedocs.io/en/latest/). Run `jupytext your-notebook.ipynb --to myst` to create a new MyST version of your file,
`your-notebook.md`. Edit this file to include the relevant sections from the docs template.
```

(contributing-without-local-setup)=
## Contributing to the napari documentation without a local setup

If you would like to see new documentation added to napari or want to see changes to existing documentation, but are not clear on these instructions or don't have the time to write it yourself, you can [open an issue](https://github.com/napari/docs/issues/new/choose).

If you are adding new documentation or modifying existing documentation and would prefer a simpler workflow than the local setup guide described below,
you can use the GitHub web interface to open your pull request
by either [uploading file(s) from your computer](https://docs.github.com/en/repositories/working-with-files/managing-files/adding-a-file-to-a-repository),
[creating and editing a new file](https://docs.github.com/en/repositories/working-with-files/managing-files/creating-new-files)
or [editing an existing file](https://docs.github.com/en/repositories/working-with-files/managing-files/editing-files)
on the [napari/docs](https://github.com/napari/docs) GitHub repository.
It's best if you first [fork](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/working-with-forks/fork-a-repo) the [napari/docs](https://github.com/napari/docs) repository to your own GitHub account, create a [feature branch](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-and-deleting-branches-within-your-repository#creating-a-branch), upload/create/edit files through the GitHub web interface, and then [open a pull request from your fork](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request-from-a-fork) back to [napari-docs](https://github.com/napari/docs).

When you submit your PR, CI will kick off several jobs, including generation of a preview of 
the documentation. By default, CI will use the `slimfast` build ("make target"), which
doesn't build any content from outside the `docs` repository or run any `docs` notebook cells.
This is great for seeing the copy and formatting. If you want to preview other elements,
you can trigger more complete builds by commenting on the PR with:
```
@napari-bot make <target>
```
where `<target>` can be:
- `html` : a full build, just like napari.org live
- `html-noplot` : a full build, but without the gallery examples from `napari/napari`
- `docs` : only the content from `napari/docs`, with notebook code cells executed
- `slimfast` : the default, only the content from `napari/docs`, without code cell execution
- `slimgallery` : `slimfast`, but also builds the gallery examples from `napari/napari` 

For more information about these targets see the ["building locally"](build_docs_locally) section 
of the documentation, including the part on [specialized builds](#building-what-you-need).  

Once the jobs complete you will also be able to [preview the documentation](doc_view_ci) by
using the `Check the rendered docs here!` action at the bottom of your PR, which will go to a 
preview website on [CircleCI](https://circleci.com/). Alternatively, you can download a zip file 
of [the build artifact](#download-documentation-artifact) and open the html files directly in your browser. For a build triggered by a comment, use
the "Triggered Docs Artifact Build" link.

If needed, a member of the maintenance team will help with updating the [napari.org](https://napari.org/dev) 
table of contents where necessary (by placing a reference to your new file in [docs/_toc.yml](update-toc))
and making sure your documentation has built correctly.

## Contributing to the napari documentation with a local setup

or alternatively use `make` directly:
build by running:
or with make:
of the changed file will be triggered automatically and will be faster,
because not everything will be built from scratch. Further, a browser preview 
will open up automatically at `http://127.0.0.1`, no need for further action! 
Edit the documents at will, and the browser will auto-reload.
on your terminal.
but otherwise want a full build, then you can use:
or with make:

```{attention}
**napari documentation now uses `pixi` for local builds!**

We have moved to [`pixi`](https://pixi.sh) as the default, cross-platform way to build and preview napari documentation. This is recommended for nearly all contributors. However, you may still want to use `make` for advanced workflows, such as headless builds or when adding new gallery examples (which requires a full local napari clone). All `make` instructions are now in the dropdown at the end of this section.
```

### Local setup and workflow (using `pixi`)

#### 0. Prerequisites

1. **Install [`pixi`](https://pixi.sh/dev/installation/)** (if not already installed):
   - Windows (PowerShell):
     ```powershell
     iwr -useb https://pixi.sh/install.ps1 | iex
     ```
   - macOS/Linux:
     ```bash
     curl -fsSL https://pixi.sh/install.sh | bash
     ```
   - After installation, restart your terminal and verify with:
     ```bash
     pixi --version
     ```

2. **Clone the napari docs repository:**
   ```bash
   git clone https://github.com/napari/docs.git napari-docs
   cd napari-docs
   ```

3. **Build the documentation locally:**
   - To run a full build (including gallery and notebook cells):
     ```bash
     pixi run html
     ```
   - To run a fast build (docs only, no gallery, no notebook execution):
     ```bash
     pixi run slimfast
     ```
   - To build docs and execute notebook cells (but skip gallery):
     ```bash
     pixi run docs
     ```
   - To build docs and gallery, but skip notebook execution:
     ```bash
     pixi run html-noplot
     ```
   - For live preview (auto-rebuild and browser preview):
     ```bash
     pixi run html-noplot-live
     ```
     or
     ```bash
     pixi run slimfast-live
     ```

   - After building, preview the docs by opening `docs/_build/html/index.html` in your browser, or run:
     ```bash
     python3 -m http.server --directory docs/_build/html
     ```

#### 1. Write your documentation

* If you are amending an existing document, you can skip straight to previewing your document.
* For new docs, use the [template](docs-template) and place your file in the appropriate folder.
* Check for broken links with:
  ```bash
  pixi run linkcheck-files -- FILES=path/to/your/document.md
  ```

#### 2. Update the table of contents (TOC)

* Add your new file to `docs/_toc.yml` in the correct section. See above for examples.

#### 3. Preview your document

* Build and preview as above. For live preview, use the `-live` variants.
* You can also preview your changes in a GitHub pull request (see below).

#### 4. Submit your pull request

* Open a PR via the GitHub web interface or command line. The napari team will help you place your document if needed.

#### 5. View documentation in a GitHub pull request

* After submitting your PR, CI will build the docs and provide a preview link at the bottom of your PR.
* You can also download the built documentation artifact and view it locally.

---

:::{dropdown} Advanced: Using `make` for headless builds and gallery examples
If you need to use `make` (e.g. for headless builds, or to add new gallery examples that require a full local napari clone), here are the legacy instructions. All advanced build options, Windows/WSL/Git Bash setup, and troubleshooting are preserved here for reference.

...existing code...

---

**Make prerequisites:**

1. Fork and clone both [napari/napari](https://github.com/napari/napari) and [napari/docs](https://github.com/napari/docs) to your machine. Place them in sibling folders with no spaces in the path.
2. Set up a clean Python environment (e.g. conda), activate it, and install napari from source with docs dependencies:
   ```bash
   python -m pip install -e ".[pyqt]" --group docs
   ```
3. Build docs with `make` from the `napari-docs` folder:
   ```bash
   make html
   ```
   See the original guide above for all build variants and options (html, html-noplot, slimfast, etc.).

**Windows users:**

* You can use `make` via Git Bash or WSL. See the full instructions above for installing `make`, setting up Git Bash, or configuring WSL for graphical output.
* For headless builds, use the `docs-xvfb` or `docs-xwfb` targets as described above.

**Gallery examples:**

* To add new examples to the gallery, you must have a full local napari clone. Place your Python scripts in `napari/examples` and ensure they have the correct docstring format.

**Cleaning and utilities:**

* Clean generated content:
  ```bash
  make clean
  ```
* Clean gallery files:
  ```bash
  make clean-gallery
  ```
* Generate external resources:
  ```bash
  make prep-docs
  ```

**Troubleshooting:**

* If you encounter issues with paths, dependencies, or graphical output, refer to the full troubleshooting notes above.
:::

## Building the documentation on Windows

:::{note}
It is very important that you clone the `napari/docs` repository to a path that does not contain spaces.
For example, `C:\Users\myusername\Documents\GitHub\napari-docs` is a valid path, but \
`C:\Users\my username\Documents\GitHub\napari-docs` is not.
If you clone the napari-docs repository to a directory following the default Windows path naming convention, e.g. \
`C:\Users\my username\Documents\GitHub\napari-docs` (note the space), and run the `make` commands to build the napari docs, it may remove unintended files from your computer as it will essentially run the command `rm -rf C:\Users`.
This is because the napari documentation is built using `make` which does not work on paths which contain spaces.
:::

**Good news for Windows users!** Building napari docs on Windows is now supported out of the box. You can use [pixi](https://pixi.sh) directly from PowerShell, Command Prompt, or any Windows terminal—no need for Git Bash or WSL. Simply follow the [pixi build instructions above](#build_docs_locally).

If you prefer to use `make` directly (or need advanced build options), you have two options:

### Option 1: Git Bash (recommended for make users)

If you want to use `make` commands directly on Windows:

1. Install `make` on Windows:
   - Install Chocolatey (a Windows package manager) by following the instructions [here](https://chocolatey.org/install).
   - Install `make` with `choco install make`.
   - Alternatively, you can download the latest `make` binary without guile from [ezwinports](https://sourceforge.net/projects/ezwinports/) and [add it to your PATH](https://learn.microsoft.com/en-us/previous-versions/office/developer/sharepoint-2010/ee537574(v=office.14)#to-add-a-path-to-the-path-environment-variable).

2. Install [Git Bash](https://gitforwindows.org/) (you should already have this if you use `git` on Windows).

3. Activate your virtual environment in Git Bash:
   - Conda environment: To have your conda environment available in Git Bash, launch Git Bash, then run `conda init bash` from anaconda prompt and restart Git Bash. The conda environment can then be activated from Git Bash with `conda activate <env_name>`.
   - Virtualenv: To have your virtualenv available in Git Bash, launch Git Bash, then run `source <path_to_virtualenv>/Scripts/activate`.

4. From Git Bash, `cd` to the napari docs repository and run `make html` or other `make` commands to build the documentation.

:::{tip}
If you use Git Bash a lot, you may want to set conda to not initialize on bash by default to speed up the launch process. This can be done with `conda config --set auto_activate_base false`. You can then activate conda in Git Bash with `conda activate base`.
:::

:::{note}
If you are using an IDE, it is likely that it will not use Git Bash by default. You may need to configure your IDE to use Git Bash as the default terminal for the napari docs. For example, in VS Code, you can set the default terminal to Git Bash for the napari docs repository by adding the following to your workspace settings:

```json
"terminal.integrated.defaultProfile.windows": "Git Bash"
```
:::

### Option 2: Windows Subsystem for Linux (WSL)

WSL is an alternative option that provides a full Linux environment on Windows. This can be useful for headless builds or if you prefer working in a Linux environment. However, **WSL is not required** for building napari docs on Windows—pixi works directly on Windows.

To use WSL:

1. Install the [Windows Subsystem for Linux](https://learn.microsoft.com/en-us/windows/wsl/install) and [choose a linux distribution](https://learn.microsoft.com/en-us/windows/wsl/install#change-the-default-linux-distribution-installed).
We will use Ubuntu for this guide since it is the default WSL distribution, easy to install, and works well with [WSLg](https://github.com/microsoft/wslg). The default method to perform this installation is to run `wsl --install -d Ubuntu` from command prompt as an administrator but you can refer to the [guide](https://learn.microsoft.com/en-us/windows/wsl/install) for other installation methods.
2. Restart your computer. On restart, you will be prompted to create a user account for WSL. This account is separate from your Windows account, but you can use the same username and password if you wish.
3. [Open up the Ubuntu distribution](https://learn.microsoft.com/en-us/windows/wsl/install#ways-to-run-multiple-linux-distributions-with-wsl) via the `Ubuntu` command and run `sudo apt update && sudo apt upgrade` to update the distribution.
4. Install a napari development environment in Ubuntu following the [contributor guide](dev-installation) and activate the virtual environment that napari was installed into.
5. Install some common QT packages and OpenGL `sudo apt install -y libdbus-1-3 libxkbcommon-x11-0 libxcb-icccm4 libxcb-image0 libxcb-keysyms1 libxcb-randr0 libxcb-render-util0 libxcb-xinerama0 libxcb-xinput0 libxcb-xfixes0 mesa-utils libglu1-mesa-dev freeglut3-dev mesa-common-dev '^libxcb.*-dev' libx11-xcb-dev libxrender-dev libxi-dev libxkbcommon-dev libxkbcommon-x11-dev`.
6. You can test that all of this OpenGL setup is working by running `glxgears` from the Ubuntu terminal. You should see a window with some gears spinning.
7. `sudo apt install fontconfig`.
8. `pip install pyqt5-tools`.
9. Fork the napari docs repository and clone it to the same parent folder as the napari repository (see [](prerequisites)). Then navigate to the napari docs folder via `cd napari-docs`.
10. Install `make` with `sudo apt install make`.
11. Run `make html` or other `make` commands to build the documentation.

````{admonition} Route graphical output to Windows
:class: tip

By default, the graphical interface to `glxgears` or `napari` from WSL should be visible on Windows via `WSLg` without any configuration.
However, if you are getting errors running `glxgears` or can't see the interface to graphical applications, then you may need to route the graphical output to Windows. To do this:

1. Install an Xserver for Windows, [Vcxsrv](https://sourceforge.net/projects/vcxsrv/). When launching it, choose the options as default, except tick "disable access control".
2. Export environment variables (you will need to do this for every new shell you open, unless you add them to your `.bashrc`):

    ```bash
    mkdir ~/temp

    export DISPLAY=$(awk '/nameserver / {print $2; exit}' /etc/resolv.conf 2>/dev/null):0
    export LIBGL_ALWAYS_INDIRECT=0
    export XDG_RUNTIME_DIR=~/temp
    export RUNLEVEL=3
    ```
3. Run `glxgears` from the Ubuntu terminal. You should see a window with some gears spinning.

````

(add-examples)=
## Adding examples to the [Gallery](gallery)

All of the examples in the [examples Gallery](gallery) are Python scripts that
live under [the `examples` folder of the napari repository](https://github.com/napari/napari/tree/main/examples).
Because of how this gallery is built, every such Python script needs a docstring
containing at least a title (following the `.rst` format of docstrings in
Python) and one or more _tags_. This ensures the example will be shown in the
correct place in the table of contents for the gallery (see, for example, the
[](tagoverview) page.)

Here's an example of what that means. The example file
[add_image.py](https://github.com/napari/napari/blob/main/examples/add_image.py)
contains the following:

```python
"""
Add image
=========

Display one image using the :func:`view_image` API.

.. tags:: visualization-basic
"""

from skimage import data
import napari

# create the viewer with an image
viewer, layer = napari.imshow(data.astronaut(), rgb=True)

if __name__ == '__main__':
    napari.run()
```

The equals signs under "Add image" mark this as the example title. The text
below is a short description of the example, and the tags are assigned by the
use of the `.. tags::` directive. In this case, the only tag associated with
this example is `visualization-basic`. Multiple tags can be separated with a
comma.

Note that the examples are `.py` source files, and any outputs and images will
be autogenerated when the documentation site is built.

````{note}
If you are running any of these examples in an interactive environment (e.g. a Jupyter notebook or
IPython console), the block

```
if __name__ == '__main__':
    napari.run()
```

is not necessary—you can copy-paste the code above it. However, it is required when running examples as scripts, using for example `python add_image.py`.
Because our example gallery is built from Python scripts, you need to ensure this
block is present in all contributed examples.
````

Finally, you can find the current example dependencies in [the `pyproject.toml` of napari/napari](https://github.com/napari/napari/blob/main/pyproject.toml) under the optional dependency `gallery`. If you add an example with a new dependency, be sure to include it here such that your example can be properly tested and built into the documentation.

### Cross-referencing Gallery examples

If you want to generate links to Gallery examples from anywhere in the docs, then the cross-referencing format you use will depend on the format of the doc you are writing. Note that the gallery examples live in `/gallery` despite being in `napari/examples` because [`docs/docs/conf.py`](https://github.com/napari/docs/blob/main/docs/conf.py) specifies that examples are built into the `gallery` directory. The [Sphinx cross-reference namespace](https://sphinx-gallery.github.io/stable/advanced.html#know-your-gallery-files) is generated with the `sphx_glr` prefix, then path separators are converted to underscores, for example `/gallery/add_image.py` becomes `_gallery_add_image.py` to get the end result `sphx_glr_gallery_add_image.py`. 

- For `.md` files (myst, used in the majority of docs), use the `{ref}` directive. ``{ref}`sphx_glr_gallery_add_image.py` `` displays as: {ref}`sphx_glr_gallery_add_image.py`
- For `.py` files (rst, used in the example gallery), cross-reference with the `:ref:` directive: `` :ref:`sphx_glr_gallery_example.py` ``.
